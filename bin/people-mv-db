#!/bin/sh -efu

. "@CMDDIR@/giter-sh-functions"

PROG=git-mv-db

usage()
{
	echo "$PROG: $*" >&2
	echo "usage: $PROG <source-directory> <dest-directory>" >&2
	exit 1
}

[ "$#" -ge 2 ] ||
	usage 'Not enough arguments.'
[ "$#" -eq 2 ] ||
	usage 'Too many arguments.'

cd "$HOME/packages"

srcdir0="$1" && shift
srcdir="$(validate_packages_dir "$srcdir0")"

dstdir0="$1" && shift
dstdir="$(validate_packages_dir "$dstdir0")"

[ -d "$srcdir.git" ] ||
	fatal "$srcdir0: source directory not available"
[ ! -e "$dstdir.git" ] ||
	fatal "$dstdir0: destination directory already exists"

cd "$srcdir.git"
cd "$HOME/packages"
mkdir -- "$dstdir.git"
mv -T -- "$srcdir.git" "$dstdir.git"
