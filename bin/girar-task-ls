#!/bin/sh -efu

. girar-sh-functions

cd "$GIRAR_TASKS"

ls1()
{
	local id="$1"; shift
	# maybe lock?
	printf "%d seq=%s" "$id" "$(cat "$id"/task/seq 2>/dev/null)"
	if [ -s "$id"/gears/1/dir ]; then
		local dir tag_name
		dir=$(cat "$id"/gears/1/dir)
		tag_name=$(cat "$id"/gears/1/tag_name)
		printf ' %s=%s' "${dir##*/}" "$tag_name"
	fi
	printf '\n'
}

ids=$(set +f; fgrep -l -x "$GIRAR_USER" [1-9]*/task/owner |
       sort -rn |cut -d/ -f1)

if [ -z "$ids" ]; then
	message "no tasks for $GIRAR_USER"
else
	for id in $ids; do
		ls1 "$id"
	done
fi
