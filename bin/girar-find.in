#!/bin/sh -eu

. girar-sh-functions
. shell-quote

PROG=girar-find-package
packages_list='@GIRAR_PACKAGES_LIST@'

usage()
{
	echo >&2 "$PROG: $*"
	echo >&2 "usage: $PROG <pattern>"
	exit 1
}

[ "$#" -ge 1 ] ||
	usage 'Not enough arguments.'
[ "$#" -eq 1 ] ||
	usage 'Too many arguments.'

[ -n "$1" -a -n "${1##*/*}" ] &&
	repo_name="$(quote_sed_regexp "$1")" ||
	fatal 'invalid pattern'

grep "/packages/$repo_name\(\.git\)\?[[:space:]]" "$packages_list" |
	sort -rn -k2,2
