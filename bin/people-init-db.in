#!/bin/sh -efu

. "@CMDDIR@/giter-sh-functions"

PROG=giter-init-db

usage()
{
	echo "$PROG: $*" >&2
	echo "usage: $PROG <directory>" >&2
	exit 1
}

[ "$#" -ge 1 ] ||
	usage 'Not enough arguments.'
[ "$#" -eq 1 ] ||
	usage 'Too many arguments.'

cd "$HOME/packages"

dir="$(validate_packages_dir "$1")" && shift
mkdir -- "$dir.git"
cd "$dir.git"
GIT_DIR=. git-init-db --template=@GITER_TEMPLATES_DIR@
echo "packages/$dir" >description
install -m600 -- /dev/null git-daemon-export-ok
pwd
