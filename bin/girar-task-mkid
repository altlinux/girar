#!/bin/sh -efu

[ "$#" -eq 0 ] || exit 1

. girar-sh-config

cd "$GIRAR_PEOPLE_QUEUE/.timestamp"

enable -f /usr/lib/bash/lockf lockf
builtin lockf -v .

num="$(find . -mindepth 1 -maxdepth 1 -regextype posix-basic -regex '^.*/[1-9][0-9]*$' -type d -printf '%f\n' |
       sort -n |tail -n1)"
[ -n "$num" ] || num=0

ts="$(date +%s)"
while ts="$(date +%s)"; [ "$ts" -le "$num" ]; do
	sleep 1
done

[ "$ts" -gt "$num" ]
mkdir -- "$ts"
echo "$ts"
[ "$num" = 0 ] || rmdir -- "$num"
