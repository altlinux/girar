#!/bin/sh -efu

. "@CMDDIR@/girar-sh-functions"

PROG=girar-init-db

usage()
{
	echo "$PROG: $*" >&2
	echo "usage: $PROG <directory>" >&2
	exit 1
}

[ "$#" -ge 1 ] ||
	usage 'Not enough arguments.'
[ "$#" -eq 1 ] ||
	usage 'Too many arguments.'

cd "$HOME"

dir="$(validate_packages_dir "$1")"; shift
mkdir -p -- "$dir.git"
cd "$dir.git"
GIT_DIR=. git init-db --template=@GIRAR_TEMPLATES_DIR@
echo "$dir" >description
install -m600 -- /dev/null git-daemon-export-ok
pwd
